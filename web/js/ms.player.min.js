$(function() {
	var _contral = false;
	var _invcont = false;
	var _vol = false;
	var _pox = 0;
	// 定时检测 当播放器就绪时初始化播放器控制组件
	var checkintv = false;
	checkintv = setInterval(function() {
		if(swfobj) {
			clearInterval(checkintv);
			playerInit();
		}
	}, 500);

	// 播放器控制组件初始化
	function playerInit() {
		var player = $('#player');
		// 添加控制组件到视图
		player.append('<div class="contral usn"><span class="playtime">--:--:-- am ---- --- ----</span><div class="btnv"><button class="fl btnPlay">&#xe613;</button><button class="fl btnVol">&#xe617;</button><div class="fl vol ani"><span class="ani"></span></div><button class="fr btnFs">&#xe615;</button></div></div>');
		_contral = $('.contral');
		// 播放控制
		var btnPlay = $('.btnPlay');
		var ligintv = false;
		btnPlay.click(function() {
			var s = ~~btnPlay.attr('status');
			clearInterval(ligintv);
			if(s) {
				ligintv = setInterval(function() {
					btnPlay.toggleClass('lig');
				}, 1000);
				s = 0;
				btnPlay.html('&#xe61a;');
			}else {
				s = 1;
				btnPlay.html('&#xe619;').removeClass('lig');
			}
			btnPlay.attr('status', s).blur();
			swfobj.setPlay(s);
		});
		// 静音控制|音量控制
		var btnVol = $('.btnVol');
		var volCtr = $('.vol');
		btnVol.click(function() {
			var v = ~~btnVol.attr('volume');
			if(v) {
				v = 0;
				btnVol.html('&#xe617;');
				volCtr.css({backgroundSize: '0% 100%'}).find('span').css({left: '0%'});
			}else {
				v = ~~volCtr.attr('volume');
				if(!v) {
					v = 50;
				}
				btnVol.html('&#xe61d;');
				volCtr.css({backgroundSize: v+'% 100%'}).find('span').css({left: v+'%'});
			}
			btnVol.attr('volume', v);
			swfobj.setVolume(v);
		});
		volCtr.mousedown(function() {
			_vol = true;
			volCtr.removeClass('ani').find('span').removeClass('ani');
		}).mousemove(function(e) {
			if(_vol) {
				var v = e.clientX - _pox;
				if(v < 0) {
					v = 0;
				}else if(v > 100) {
					v = 100;
				}
				volCtr.css({backgroundSize: v+'% 100%'}).find('span').css({left: v+'%'});
				btnVol.attr('volume', v);
				volCtr.attr('volume', v);
				if(v > 0) {
					btnVol.html('&#xe61d;');
				}else {
					btnVol.html('&#xe617;');
				}
				swfobj.setVolume(v);
			}
		}).mouseup(function() {
			_vol = false;
			volCtr.addClass('ani').find('span').addClass('ani');
		}).mouseout(function() {
			_vol = false;
			volCtr.addClass('ani').find('span').addClass('ani');
		});
		
		// 全屏控制
		var btnFs = $('.btnFs');
		player.onFullscreenChange(function(s) {
			if(!s) {
				btnFs.removeAttr('fullscreen').html('&#xe615;');
				player.fullscreen(false);
			}
			setTimeout(function() {
				_pox = $('.vol').offset().left;
			}, 500);
		});
		btnFs.click(function() {
			var fs = btnFs.attr('fullscreen');
			if(fs) {
				btnFs.removeAttr('fullscreen').html('&#xe615;');
				player.fullscreen(false);
			}else {
				btnFs.attr('fullscreen', '1').html('&#xe61c;');
				player.fullscreen(true);
			}
		});
		// 显示控制器
		showContral();
		// 添加收起事件控制
		player.mousemove(function() {
			showContral();
			if(_invcont) {
				clearTimeout(_invcont);
			}
			_invcont = setTimeout(hideContral, 5000);
		}).mousemove();
	}
	
	// 播放器控制组件显示
	function showContral() {
		if(_contral && _contral.is(':hidden')) {
			_contral.transition({display: 'block', opacity: 0, y: '100%'});
			_contral.transition({y: 0, opacity: 1}, 500, function() {
				_contral.attr('style', 'display:block');
				_pox = $('.vol').offset().left;
			});
		}
	}
	
	// 播放器控制组件收起
	function hideContral() {
		if(_contral && _contral.is(':visible')) {
			_contral.transition({y: '100%', opacity: 0}, 500, function() {
				_contral.attr('style', 'display:none');
			});
		}
		_invcont = false;
	}
});